<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>eBay Hot Items Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      max-width: 900px; margin:0 auto; padding:16px; line-height:1.6;
    }
    h1{ font-size:1.4rem; margin:0 0 10px; }
    .card{ border:1px solid #ddd; border-radius:10px; padding:16px; margin-bottom:16px; }
    label{ display:block; margin-top:10px; font-weight:800; }

    input,select,textarea{
      width:100%; padding:10px; margin-top:6px; font-size:1rem;
      border-radius:8px; border:1px solid #ccc; box-sizing:border-box;
    }

    button{
      padding:10px;
      font-size:1rem; border-radius:8px; border:none; cursor:pointer;
    }
    .btn-secondary{ background:#eee; }
    .btn-copy{ background:#444; color:#fff; width:100%; margin-top:10px; }
    .btn-clear{ background:#f1f3f4; color:#333; padding:8px 10px; font-size:.95rem; }

    .small{ font-size:.95rem; color:#555; margin-top:10px; }
    .result{ font-size:1.05rem; margin-top:10px; }

    .hot{ color:#d32f2f; font-weight:900; }
    .warm{ color:#f57c00; font-weight:900; }
    .cold{ color:#1976d2; font-weight:900; }

    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .row3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; }
    @media(max-width:720px){ .row3{ grid-template-columns:1fr; } }
    @media(max-width:640px){ .row2{ grid-template-columns:1fr; } }

    a.linkish{
      color:#1a73e8;
      text-decoration: underline;
      font-weight: 700;
    }
    .linksWrap{ margin-top: 12px; display: grid; gap: 8px; }
    .linkRow{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      background:#f1f3f4;
      color:#444;
      font-size:.85rem;
      font-weight:700;
    }
    .muted{ color:#666; font-size:.9rem; }

    .labelRow{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
    }
    .labelRow label{ margin-top:0; }
    .kwWrap{ margin-top:10px; }

    .actionsRow{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:10px;
    }
  </style>
</head>
<body>

<h1>ğŸ”¥ eBay Hot Items Checker</h1>

<div class="card">

  <div class="labelRow">
    <label>å‹ç•ª / ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
    <button class="btn-clear" type="button" onclick="clearInputs()">ã‚¯ãƒªã‚¢</button>
  </div>
  <div class="kwWrap">
    <input id="keyword" type="text" placeholder="ä¾‹ï¼šNikon 50mm F/1.4 Ai-s">
  </div>

  <!-- âœ… å‹ç•ª/ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ä¸‹ã« JPYâ†’USD -->
  <div class="row2">
    <div>
      <label>JPYï¼šå£²ã‚Œç­‹ã®ä¾¡æ ¼ï¼ˆä¸­å¿ƒå€¤ï¼‰</label>
      <input id="priceJpy" type="number" inputmode="numeric" placeholder="ä¾‹ï¼š15000ï¼ˆæœªå…¥åŠ›OKï¼‰">
    </div>
    <div>
      <label>USDï¼šå£²ã‚Œç­‹ã®ä¾¡æ ¼ï¼ˆä¸­å¿ƒå€¤ï¼‰</label>
      <input id="priceUsd" type="number" inputmode="decimal" placeholder="ä¾‹ï¼š100ï¼ˆæœªå…¥åŠ›OKï¼‰">
    </div>
  </div>

  <!-- âœ… çŠ¶æ…‹ / ã‚«ãƒ†ã‚´ãƒªãƒ¼ / ãƒªã‚µãƒ¼ãƒæœŸé–“ï¼ˆ3ã¤ä¸¦ã³ï¼‰ -->
  <div class="row3">
    <div>
      <label>çŠ¶æ…‹</label>
      <select id="condition">
        <option value="USED" selected>Used</option>
        <option value="NEW">New</option>
      </select>
    </div>

    <div>
      <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
      <select id="category">
        <option value="0" selected>All</option>
        <option value="625">Cameras &amp; Photo</option>
        <option value="78997">Lenses &amp; Filters</option>
        <option value="31388">Digital Cameras</option>
        <option value="69323">Film Photography</option>
        <option value="15200">Camera, Drone &amp; Photo Accessories</option>
        <option value="64353">Flashes &amp; Flash Accessories</option>
        <option value="28179">Binoculars &amp; Telescopes</option>
        <option value="182074">Replacement Parts &amp; Tools</option>
        <option value="3326">Vintage Movie &amp; Photography</option>
        <option value="30078">Lighting &amp; Studio</option>
        <option value="30090">Tripods &amp; Supports</option>
        <option value="21162">Video Production &amp; Editing</option>
        <option value="11724">Camcorders</option>
      </select>
    </div>

    <div>
      <label>ãƒªã‚µãƒ¼ãƒæœŸé–“ï¼ˆProduct Researchç”¨ï¼‰</label>
      <select id="dayRange">
        <option value="30">30æ—¥</option>
        <option value="90" selected>90æ—¥</option>
        <option value="180">180æ—¥</option>
      </select>
    </div>
  </div>

  <!-- âœ… Seller Location / ä¸¦ã³é † / å£²ã‚Œç­‹ãƒ¬ãƒ³ã‚¸ -->
  <div class="row3">
    <div>
      <label>Seller Location</label>
      <select id="sellerLocation">
        <option value="ALL" selected>All</option>
        <option value="JP">Japan</option>
        <option value="US">United States</option>
      </select>
    </div>

    <div>
      <label>ä¸¦ã³é †ï¼ˆProduct Researchã®ã¿ï¼‰</label>
      <select id="prSorting">
        <option value="-avgsalesprice" selected>ä¾¡æ ¼é«˜ã„é †</option>
        <option value="-itemssold">Soldå¤šã„é †</option>
      </select>
    </div>

    <div>
      <label>å£²ã‚Œç­‹ã®ä¾¡æ ¼ãƒ¬ãƒ³ã‚¸ï¼ˆÂ±%ï¼‰</label>
      <select id="range">
        <option value="2">Â±2%</option>
        <option value="5">Â±5%</option>
        <option value="10" selected>Â±10%</option>
        <option value="15">Â±15%</option>
        <option value="20">Â±20%</option>
        <option value="25">Â±25%</option>
      </select>
    </div>
  </div>

  <!-- âœ… ç‚ºæ›¿ã¯æœ€å¾Œ -->
  <div>
    <label>ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆï¼ˆ1 USD = JPYï¼‰</label>
    <input id="fx" type="number" inputmode="decimal" placeholder="ä¾‹ï¼š150" value="150">
  </div>

  <div class="linksWrap">
    <div class="linkRow">
      <span class="pill">SOLD</span>
      <a id="prLink" class="linkish" href="#" target="_blank" rel="noopener noreferrer" onclick="return false;">Product Research ã§è¦‹ã‚‹</a>
      <span class="muted" id="prHint"></span>
    </div>
    <div class="linkRow">
      <span class="pill">SOLD</span>
      <a id="arLink" class="linkish" href="#" target="_blank" rel="noopener noreferrer" onclick="return false;">Advanced Research ã§è¦‹ã‚‹</a>
      <span class="muted" id="arHint"></span>
    </div>
  </div>

  <div class="small">
    â€» Advanced Researchã¯å¸¸ã«90æ—¥ç›¸å½“ï¼ˆæœŸé–“è¨­å®šã¯åæ˜ ã—ã¾ã›ã‚“ï¼‰
  </div>
</div>

<div class="card">
  <div class="row3">
    <div>
      <label>æŒ‡å®šæœŸé–“Soldæ•°</label>
      <input id="sold" type="number" inputmode="numeric" placeholder="ä¾‹ï¼š20">
    </div>
    <div>
      <label>Active listingsï¼ˆå‡ºå“æ•°ï¼‰</label>
      <input id="active" type="number" inputmode="numeric" placeholder="ä¾‹ï¼š40">
    </div>
    <div>
      <label>åºƒå‘Šåˆ©ç”¨ç‡ï¼ˆPromoted listingsï¼‰</label>
      <input id="promoted" type="number" inputmode="numeric" placeholder="ä¾‹ï¼š50ï¼ˆæœªå…¥åŠ›OKï¼‰" min="0" max="100">
    </div>
  </div>

  <div class="actionsRow">
    <button class="btn-secondary" type="button" onclick="calculate()" style="flex:1;">åˆ¤å®šã™ã‚‹</button>
  </div>

  <div id="output"></div>

  <div id="copyArea" style="display:none;">
    <label style="margin-top:14px;">åˆ¤å®šçµæœï¼ˆã‚³ãƒ”ãƒ¼ç”¨ï¼‰</label>
    <textarea id="resultText" rows="22" readonly></textarea>
    <button class="btn-copy" type="button" onclick="copyResult()">åˆ¤å®šçµæœã‚’ã‚³ãƒ”ãƒ¼</button>
    <div id="copyMsg" class="small"></div>
  </div>
</div>

<script>
  function ymd(d=new Date()){
    const yyyy=d.getFullYear();
    const mm=String(d.getMonth()+1).padStart(2,"0");
    const dd=String(d.getDate()).padStart(2,"0");
    return `${yyyy}-${mm}-${dd}`;
  }
  function fmtInt(n){ if(!isFinite(n)) return "0"; return Math.round(n).toString(); }
  function fmtMoneyUsd(n){ if(!isFinite(n)) return "$0"; return "$"+Math.round(n).toLocaleString("en-US"); }
  function fmtMoneyJpy(n){ if(!isFinite(n)) return "Â¥0"; return "Â¥"+Math.round(n).toLocaleString("ja-JP"); }
  function fmtMonths(n){
    if(!isFinite(n)) return "âˆ";
    const r=Math.round(n*10)/10;
    return (Math.abs(r-Math.round(r))<1e-9) ? String(Math.round(r)) : String(r);
  }
  function clamp(n, min, max){ return Math.min(max, Math.max(min, n)); }
  function conditionIdFromSelect(v){ return v==="NEW" ? "1000" : "3000"; }
  function conditionTextFromSelect(v){ return v==="NEW" ? "New" : "Used"; }

  function sellerLocationText(v){
    if (v==="JP") return "Japan";
    if (v==="US") return "United States";
    return "All";
  }

  function categoryTextFromId(id){
    const el = document.getElementById("category");
    const opt = el.querySelector(`option[value="${id}"]`);
    return opt ? opt.textContent : "All";
  }

  function sortingText(v){
    return v === "-itemssold" ? "Soldå¤šã„é †" : "ä¾¡æ ¼é«˜ã„é †";
  }

  function getFx(){
    const fx = Number(document.getElementById("fx").value);
    return (isFinite(fx) && fx > 0) ? fx : 150;
  }

  // JPYå„ªå…ˆ â†’ USD ã®é †
  function resolveCenterPrices(){
    const fx = getFx();
    const usdRaw = document.getElementById("priceUsd").value;
    const jpyRaw = document.getElementById("priceJpy").value;

    const usd = usdRaw !== "" ? Number(usdRaw) : null;
    const jpy = jpyRaw !== "" ? Number(jpyRaw) : null;

    if (jpy != null && isFinite(jpy) && jpy > 0) {
      return { usdCenter: jpy / fx, jpyCenter: jpy, source: "JPY", fx };
    }
    if (usd != null && isFinite(usd) && usd > 0) {
      return { usdCenter: usd, jpyCenter: usd * fx, source: "USD", fx };
    }
    return null;
  }

  function calcMinMax(center, rangePct){
    const min = Math.max(0, Math.floor(center * (1 - rangePct/100)));
    const max = Math.ceil(center * (1 + rangePct/100));
    return {min, max};
  }

  // âœ… Product Researchï¼šcategoryId / sorting / sellerCountry / conditionId
  function buildProductResearchUrl({keyword, minUsd, maxUsd, dayRange, conditionId, sellerLocation, categoryId, sorting}){
    const endDate = Date.now();
    const startDate = endDate - (Number(dayRange) * 24 * 60 * 60 * 1000);

    const params = new URLSearchParams({
      marketplace:"EBAY-US",
      keywords: keyword,
      dayRange: String(dayRange),
      endDate: String(endDate),
      startDate: String(startDate),
      categoryId: String(categoryId ?? 0),
      offset:"0",
      limit:"50",
      sorting: String(sorting || "-avgsalesprice"),
      tabName:"SOLD",
      tz:"Asia/Tokyo"
    });

    if (conditionId) params.set("conditionId", conditionId);

    if (minUsd != null && maxUsd != null) {
      params.set("minPrice", String(minUsd));
      params.set("maxPrice", String(maxUsd));
    }

    if (sellerLocation === "JP") params.set("sellerCountry", "SellerLocation:::JP");
    if (sellerLocation === "US") params.set("sellerCountry", "SellerLocation:::US");

    return `https://www.ebay.com/sh/research?${params.toString()}`;
  }

  // âœ… Advanced Researchï¼š_sacat ã« categoryIdï¼ˆåŒã˜ç•ªå·ï¼‰ / _sop=16å›ºå®š / locatedin / condition
  function buildAdvancedResearchUrl({keyword, minJpy, maxJpy, conditionId, sellerLocation, categoryId}){
    const params = new URLSearchParams({
      _nkw: keyword,
      _sacat: String(categoryId ?? 0),
      LH_Complete: "1",
      LH_Sold: "1",
      _sop: "16"
    });

    if (conditionId) params.set("LH_ItemCondition", String(conditionId));

    if (minJpy != null && maxJpy != null) {
      params.set("_udlo", String(minJpy));
      params.set("_udhi", String(maxJpy));
    }

    if (sellerLocation === "JP") {
      params.set("_salic", "104");
      params.set("LH_LocatedIn", "1");
    } else if (sellerLocation === "US") {
      params.set("_salic", "1");
      params.set("LH_LocatedIn", "1");
    }

    return `https://www.ebay.com/sch/i.html?${params.toString()}`;
  }

  function setLink(el, url){
    el.href = url;
    el.target = "_blank";
    el.rel = "noopener noreferrer";
    el.onclick = () => true;
  }

  function updateLinks(){
    const keyword = document.getElementById("keyword").value.trim();
    const condSel = document.getElementById("condition").value;
    const conditionId = conditionIdFromSelect(condSel);
    const conditionText = conditionTextFromSelect(condSel);

    const dayRange = Number(document.getElementById("dayRange").value);
    const rangePct = Number(document.getElementById("range").value);

    const sellerLocation = document.getElementById("sellerLocation").value;
    const categoryId = Number(document.getElementById("category").value);
    const prSorting = document.getElementById("prSorting").value;

    const prLink = document.getElementById("prLink");
    const arLink = document.getElementById("arLink");
    const prHint = document.getElementById("prHint");
    const arHint = document.getElementById("arHint");

    if(!keyword){
      prLink.href="#"; arLink.href="#";
      prLink.onclick = (e)=>{ e.preventDefault(); alert("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); };
      arLink.onclick = (e)=>{ e.preventDefault(); alert("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); };
      prHint.textContent="ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ï¼‰";
      arHint.textContent="ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ï¼‰";
      return;
    }

    const prices = resolveCenterPrices();
    let minUsd=null, maxUsd=null, minJpy=null, maxJpy=null;

    const catTxt = categoryId === 0 ? "" : ` / ${categoryTextFromId(String(categoryId))}`;
    const locTxt = sellerLocation !== "ALL" ? ` / ${sellerLocationText(sellerLocation)}` : "";
    const sortTxt = ` / ${sortingText(prSorting)}`;

    if(prices){
      const mmUsd = calcMinMax(prices.usdCenter, rangePct);
      minUsd=mmUsd.min; maxUsd=mmUsd.max;

      const mmJpy = calcMinMax(prices.jpyCenter, rangePct);
      minJpy=mmJpy.min; maxJpy=mmJpy.max;

      prHint.textContent = `ï¼ˆ${fmtMoneyUsd(minUsd)} - ${fmtMoneyUsd(maxUsd)} / ${dayRange}æ—¥ / ${conditionText}${locTxt}${catTxt}${sortTxt}ï¼‰`;
      arHint.textContent = `ï¼ˆ${fmtMoneyJpy(minJpy)} - ${fmtMoneyJpy(maxJpy)} / 90æ—¥å›ºå®š / ${conditionText}${locTxt}${catTxt}ï¼‰`;
    } else {
      prHint.textContent = `ï¼ˆ${dayRange}æ—¥ / ${conditionText}${locTxt}${catTxt}${sortTxt}ï¼‰`;
      arHint.textContent = `ï¼ˆ90æ—¥å›ºå®š / ${conditionText}${locTxt}${catTxt}ï¼‰`;
    }

    const prUrl = buildProductResearchUrl({
      keyword, minUsd, maxUsd, dayRange, conditionId,
      sellerLocation, categoryId, sorting: prSorting
    });
    const arUrl = buildAdvancedResearchUrl({
      keyword, minJpy, maxJpy, conditionId,
      sellerLocation, categoryId
    });

    window.__lastProductUrl = prUrl;
    window.__lastAdvancedUrl = arUrl;

    setLink(prLink, prUrl);
    setLink(arLink, arUrl);
  }

  function calcListingsSplit(activeTotal, promotedPct){
    if (promotedPct == null) return { noAds: activeTotal, ads: null };
    const p = clamp(promotedPct, 0, 100);
    const ads = Math.round(activeTotal * (p/100));
    const noAds = Math.max(0, activeTotal - ads);
    return { noAds, ads, pct:p };
  }

  function calculate(){
    const keyword = document.getElementById("keyword").value.trim();
    const condSel = document.getElementById("condition").value;
    const conditionText = conditionTextFromSelect(condSel);
    const conditionId = conditionIdFromSelect(condSel);

    const dayRange = Number(document.getElementById("dayRange").value);
    const rangePct = Number(document.getElementById("range").value);

    const sellerLocation = document.getElementById("sellerLocation").value;
    const sellerLocationTxt = sellerLocationText(sellerLocation);

    const categoryId = Number(document.getElementById("category").value);
    const categoryTxt = categoryTextFromId(String(categoryId));

    const prSorting = document.getElementById("prSorting").value;
    const prSortingTxt = sortingText(prSorting);

    const soldRaw = document.getElementById("sold").value;
    const activeRaw = document.getElementById("active").value;
    const promotedRaw = document.getElementById("promoted").value;

    if(!keyword){ alert("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
    if(soldRaw==="" || activeRaw===""){ alert("Soldæ•°ã¨Active listingsã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }

    const sold = Number(soldRaw);
    const active = Number(activeRaw);

    const prices = resolveCenterPrices();
    const fx = getFx();

    let usdCenter=null, jpyCenter=null, mmUsd=null, mmJpy=null;
    if (prices) {
      usdCenter = prices.usdCenter;
      jpyCenter = prices.jpyCenter;
      mmUsd = calcMinMax(usdCenter, rangePct);
      mmJpy = calcMinMax(jpyCenter, rangePct);
    }

    const productUrl = window.__lastProductUrl || buildProductResearchUrl({
      keyword,
      minUsd: mmUsd ? mmUsd.min : null,
      maxUsd: mmUsd ? mmUsd.max : null,
      dayRange,
      conditionId,
      sellerLocation,
      categoryId,
      sorting: prSorting
    });

    const advancedUrl = window.__lastAdvancedUrl || buildAdvancedResearchUrl({
      keyword,
      minJpy: mmJpy ? mmJpy.min : null,
      maxJpy: mmJpy ? mmJpy.max : null,
      conditionId,
      sellerLocation,
      categoryId
    });

    const monthlySold = (dayRange>0) ? (sold / (dayRange/30)) : 0;

    const promotedPct = (promotedRaw !== "") ? Number(promotedRaw) : null;
    const split = calcListingsSplit(active, (promotedRaw !== "" && isFinite(promotedPct)) ? promotedPct : null);

    const effectiveActive = (split.ads == null) ? split.noAds : Math.max(1e-9, split.ads);
    const rotationRate = (effectiveActive>0) ? (monthlySold/effectiveActive*100) : 0;
    const inventoryMonths = (monthlySold>0) ? (effectiveActive/monthlySold) : Infinity;

    let judge="", cls="";
    if(inventoryMonths<=1.5){
      judge="ğŸ”¥ HOTï¼šã™ãã«å£²ã‚Œã‚‹å•†å“ï¼ˆç‹™ã„ç›®ï¼‰";
      cls="hot";
    } else if(inventoryMonths<=4){
      judge="ğŸŒ¤ WARMï¼šæ¯”è¼ƒçš„å£²ã‚Œã‚„ã™ã„ï¼ˆä¾¡æ ¼ãƒ»çŠ¶æ…‹æ¬¡ç¬¬ï¼‰";
      cls="warm";
    } else {
      judge="â„ COLDï¼šé•·æœŸåœ¨åº«ã«ãªã‚Šã‚„ã™ã„";
      cls="cold";
    }

    const monthlySoldInt = fmtInt(monthlySold);
    const rotationInt = fmtInt(rotationRate);
    const inventoryTxt = fmtMonths(inventoryMonths);

    const uiLines = [];
    uiLines.push(`æŒ‡å®šæœŸé–“Soldæ•°ï¼š${fmtInt(sold)}ï¼ˆ${dayRange}æ—¥ï¼‰`);
    uiLines.push(`æœˆé–“Soldæ•°ï¼š${monthlySoldInt}å€‹ / æœˆ`);
    if (split.ads == null) {
      uiLines.push(`Active listingsï¼š${fmtInt(split.noAds)}å€‹ï¼ˆåºƒå‘Šãªã—ï¼‰`);
    } else {
      uiLines.push(`Active listingsï¼š${fmtInt(split.noAds)}å€‹ï¼ˆåºƒå‘Šãªã—ï¼‰`);
      uiLines.push(`Active listingsï¼š${fmtInt(split.ads)}å€‹ï¼ˆåºƒå‘Šã‚ã‚Šï¼‰`);
      uiLines.push(`åºƒå‘Šåˆ©ç”¨ç‡ï¼š${fmtInt(split.pct)}ï¼…`);
    }
    uiLines.push(`å›è»¢ç‡ï¼š${rotationInt}% / æœˆ`);
    uiLines.push(`åœ¨åº«æœŸé–“ï¼š${inventoryTxt}ãƒµæœˆ`);

    let html = `<div class="result">${uiLines.join("<br>")}</div>`;
    html += `<div class="result"><span style="font-weight:900;">åˆ¤å®šçµæœï¼š</span><span class="${cls}" style="font-weight:900;">${judge}</span></div>`;
    document.getElementById("output").innerHTML = html;

    const today = ymd(new Date());
    const out=[];
    out.push("eBay Hot Items Checker");
    out.push(`â– ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼š${keyword}`);
    out.push(`çŠ¶æ…‹ï¼š${conditionText}`);
    out.push(`Seller Locationï¼š${sellerLocationTxt}`);
    out.push(`ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼š${categoryTxt}`);
    out.push(`ä¸¦ã³é †ï¼š${prSortingTxt}`);

    if (usdCenter != null && jpyCenter != null && mmUsd && mmJpy) {
      out.push(`å£²ã‚Œç­‹ã®ä¾¡æ ¼ï¼ˆä¸­å¿ƒå€¤ï¼‰ï¼š${fmtMoneyUsd(usdCenter)} / ${fmtMoneyJpy(jpyCenter)}`);
      out.push(`å£²ã‚Œç­‹ã®ä¾¡æ ¼ãƒ¬ãƒ³ã‚¸ï¼šÂ±${rangePct}%ï¼ˆ${fmtMoneyUsd(mmUsd.min)} - ${fmtMoneyUsd(mmUsd.max)} / ${fmtMoneyJpy(mmJpy.min)} - ${fmtMoneyJpy(mmJpy.max)}ï¼‰`);
      out.push(`ç‚ºæ›¿ï¼š1 USD = ${fx} JPY`);
    } else {
      out.push(`å£²ã‚Œç­‹ã®ä¾¡æ ¼ï¼ˆä¸­å¿ƒå€¤ï¼‰ï¼š`);
      out.push(`å£²ã‚Œç­‹ã®ä¾¡æ ¼ãƒ¬ãƒ³ã‚¸ï¼šÂ±${rangePct}%ï¼ˆï¼‰`);
      out.push(`ç‚ºæ›¿ï¼š1 USD = ${fx} JPY`);
    }

    out.push(`æœŸé–“ï¼š${dayRange}æ—¥`);
    out.push(`Soldï¼š${fmtInt(sold)}å€‹`);
    out.push(`æœˆæ›ç®— Soldï¼š${monthlySoldInt}å€‹ / æœˆ`);
    if (split.ads == null) {
      out.push(`Active listingsï¼š${fmtInt(split.noAds)}å€‹ï¼ˆåºƒå‘Šãªã—ï¼‰`);
    } else {
      out.push(`Active listingsï¼š${fmtInt(split.noAds)}å€‹ï¼ˆåºƒå‘Šãªã—ï¼‰`);
      out.push(`Active listingsï¼š${fmtInt(split.ads)}å€‹ï¼ˆåºƒå‘Šã‚ã‚Šï¼‰`);
      out.push(`åºƒå‘Šåˆ©ç”¨ç‡ï¼š${fmtInt(split.pct)}ï¼…`);
    }

    out.push("");
    out.push(`å›è»¢ç‡ï¼š${rotationInt}% / æœˆ`);
    out.push(`åœ¨åº«æœŸé–“ï¼š${inventoryTxt}ãƒµæœˆ`);
    out.push("");
    out.push(`åˆ¤å®šçµæœï¼š${judge}`);
    out.push(`Product Research URLï¼š${productUrl}`);
    out.push(`Advanced Research URLï¼š${advancedUrl}`);
    out.push(`æ—¥ä»˜ï¼š${today}`);

    document.getElementById("resultText").value = out.join("\n");
    document.getElementById("copyArea").style.display = "block";
    document.getElementById("copyMsg").textContent = "";
  }

  async function copyResult(){
    const txt=document.getElementById("resultText").value;
    try{
      await navigator.clipboard.writeText(txt);
      document.getElementById("copyMsg").textContent="ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ âœ…";
    }catch(e){
      const ta=document.getElementById("resultText");
      ta.focus(); ta.select();
      document.getElementById("copyMsg").textContent="ç›´æ¥ã‚³ãƒ”ãƒ¼ã§ããªã„ãŸã‚é¸æŠçŠ¶æ…‹ã«ã—ã¾ã—ãŸï¼ˆCtrl+Cã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ï¼‰";
    }
  }

  function closeResults(){
    document.getElementById("output").innerHTML = "";
    document.getElementById("copyArea").style.display = "none";
    document.getElementById("resultText").value = "";
    document.getElementById("copyMsg").textContent = "";
  }

  function clearInputs(){
    document.getElementById("keyword").value = "";
    document.getElementById("priceUsd").value = "";
    document.getElementById("priceJpy").value = "";
    document.getElementById("sold").value = "";
    document.getElementById("active").value = "";
    document.getElementById("promoted").value = "";
    closeResults();
    updateLinks();
  }

  // å…¥åŠ›å¤‰æ›´ã§ãƒªãƒ³ã‚¯æ›´æ–°
  ["keyword","condition","category","dayRange","priceUsd","priceJpy","sellerLocation","prSorting","range","fx"].forEach(id=>{
    const el = document.getElementById(id);
    el.addEventListener("input", updateLinks);
    el.addEventListener("change", updateLinks);
  });

  updateLinks();
</script>

</body>
</html>
