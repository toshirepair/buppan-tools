<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カメラレンズ相場リサーチリンク生成ツール（Googleレンズ連携版）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
      line-height: 1.6;
    }
    h1 {
      font-size: 1.3rem;
      margin-bottom: 0.5rem;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      margin-top: 12px;
    }
    label {
      display: inline-block;
      margin-right: 12px;
      margin-bottom: 4px;
    }
    button {
      padding: 8px 14px;
      font-size: 0.95rem;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: #2563eb;
      color: #fff;
      margin-top: 8px;
      margin-right: 4px;
    }
    button.secondary {
      background: #6b7280;
    }
    button:disabled {
      background: #9ca3af;
      cursor: default;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .small {
      font-size: 0.85rem;
      color: #555;
    }
    ul.result-list {
      list-style: none;
      padding-left: 0;
      margin-top: 8px;
    }
    ul.result-list li {
      margin-bottom: 10px;
    }
    a.result-link {
      font-size: 0.95rem;
      text-decoration: underline;
      color: #2563eb;
    }
    textarea.copy-area {
      width: 100%;
      min-height: 120px;
      box-sizing: border-box;
      font-size: 0.85rem;
      margin-top: 8px;
      white-space: pre-wrap;
    }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #e5e7eb;
      margin-left: 4px;
    }
  </style>
</head>
<body>
  <h1>カメラレンズ相場リサーチリンク生成ツール（Googleレンズ連携版）</h1>
  <p class="small">
    店舗でカメラやレンズを見ながら、<br>
    Googleレンズで型番などの文字を読み取り、その文字をベースに<br>
    eBay／ヤフオク／メルカリ の相場リサーチ用URLを作るツールです。<br>
    ※ 文字認識は Googleレンズ を利用し、このツールはキーワード入力＋リンク生成に専念します。
  </p>

  <!-- ① Googleレンズ & キーワード入力 -->
  <div class="card">
    <h2 style="font-size:1.05rem; margin-top:0;">1. Googleレンズ or 手入力でキーワードを用意する</h2>
    <p class="small">
      ▼ おすすめの使い方<br>
      1. 下の「Googleレンズを開く」ボタンを押す<br>
      2. レンズでカメラやレンズの型番ラベルを読み取る<br>
      3. レンズが認識したテキストをコピー<br>
      4. このツールに戻って、下の「検索キーワード」に貼り付ける<br>
      <br>
      ※ Googleレンズを使わず、最初から手入力だけでもOKです。
    </p>

    <button id="openGoogleLensBtn" class="secondary">
      Googleレンズを開く（別タブ）
    </button>
    <p class="small">
      ※ スマホの場合は、Googleアプリやブラウザがレンズ対応していれば、<br>
      &nbsp;&nbsp;そのままカメラを使って文字を読み取れます。<br>
      ※ 認識したテキストをコピーして、このページの<br>
      &nbsp;&nbsp;「検索キーワード」に貼り付けてご利用ください。
    </p>
  </div>

  <!-- ② キーワード確定＆相場リンク生成部分 -->
  <div class="card">
    <h2 style="font-size:1.05rem; margin-top:0;">2. 検索キーワード & サイト選択</h2>

    <div>
      <label for="searchKeyword"><strong>検索キーワード（最終的にこれで相場を見る）</strong></label>
      <input type="text" id="searchKeyword" placeholder="例：Nikon AF-S NIKKOR 24-70mm f/2.8G ED など">
      <p class="small">
        Googleレンズで認識した文字をペーストするか、手入力してください。
      </p>
    </div>

    <div style="margin-top:12px;">
      <div><strong>リサーチするサイト</strong></div>
      <label><input type="checkbox" id="useEbay" checked> eBay<span class="badge">SOLD</span></label>
      <label><input type="checkbox" id="useYahu" checked> ヤフオク<span class="badge">落札相場</span></label>
      <label><input type="checkbox" id="useMercari" checked> メルカリ<span class="badge">売り切れ</span></label>
      <p class="small">
        まずは3サイトに絞っています。将来的にラクマやAmazonなども足すことも可能です。
      </p>
    </div>

    <button id="buildLinksBtn">このキーワードで相場リサーチリンクを作る</button>
  </div>

  <!-- ③ 結果リンク＆コピー部分 -->
  <div id="result" class="card" style="display:none; margin-top:16px;">
    <strong>3. リンク一覧（スマホ／PC共通）</strong>
    <div id="resultLinks" class="small" style="margin-top:8px;"></div>
  </div>

  <script>
    const openGoogleLensBtn = document.getElementById("openGoogleLensBtn");
    const searchKeywordInput = document.getElementById("searchKeyword");
    const buildLinksBtn = document.getElementById("buildLinksBtn");
    const resultDiv = document.getElementById("result");
    const resultLinks = document.getElementById("resultLinks");

    // Googleレンズを別タブで開く
    if (openGoogleLensBtn) {
      openGoogleLensBtn.addEventListener("click", () => {
        // 公開されているレンズのWeb版URLを別タブで開くだけ（規約的に安全な範囲）
        window.open("https://lens.google.com/", "_blank", "noopener");
      });
    }

    // 相場リサーチリンク生成
    buildLinksBtn.addEventListener("click", () => {
      const kw = searchKeywordInput.value.trim();
      if (!kw) {
        alert("検索キーワードが空です。Googleレンズからコピーするか、手入力してください。");
        searchKeywordInput.focus();
        return;
      }

      const useEbay = document.getElementById("useEbay").checked;
      const useYahu = document.getElementById("useYahu").checked;
      const useMercari = document.getElementById("useMercari").checked;

      if (!useEbay && !useYahu && !useMercari) {
        alert("少なくとも1つのサイトを選択してください。");
        return;
      }

      const encoded = encodeURIComponent(kw);
      const links = [];

      // eBay SOLD（高い順）
      if (useEbay) {
        const baseEbay =
          "https://www.ebay.com/sch/i.html?_nkw=TESTWORD&_sacat=0&_from=R40&LH_Sold=1&LH_Complete=1&_sop=16";
        const urlEbay = baseEbay.replace("TESTWORD", encoded);
        links.push({ label: "eBay（SOLD・高い順）", url: urlEbay });
      }

      // ヤフオク落札相場（高い順）
      if (useYahu) {
        const baseYahu =
          "https://auctions.yahoo.co.jp/closedsearch/closedsearch?p=TESTWORD&va=TESTWORD&b=1&n=100&select=2";
        const urlYahu = baseYahu.replace(/TESTWORD/g, encoded);
        links.push({ label: "ヤフオク落札相場（高い順）", url: urlYahu });
      }

      // メルカリ売り切れ（高い順）
      if (useMercari) {
        const baseMercari =
          "https://jp.mercari.com/search?keyword=TESTWORD&status=sold_out%7Ctrading&sort=price&order=desc";
        const urlMercari = baseMercari.replace("TESTWORD", encoded);
        links.push({ label: "メルカリ（売り切れ・高い順）", url: urlMercari });
      }

      renderLinks(links, kw);
    });

    function renderLinks(links, keyword) {
      if (!links || links.length === 0) {
        resultDiv.style.display = "none";
        resultLinks.innerHTML = "";
        return;
      }

      let html = '<ul class="result-list">';
      links.forEach(link => {
        html += `
          <li>
            <a class="result-link" href="${link.url}" target="_blank" rel="noopener noreferrer">
              <strong>${link.label}</strong>
            </a>
          </li>
        `;
      });
      html += "</ul>";

      let copyText = "";
      copyText += `検索キーワード：${keyword}\n\n`;
      links.forEach(link => {
        copyText += `${link.label}\n${link.url}\n\n`;
      });

      html += `
        <p style="margin-top:12px; font-weight:bold;">コピー用（チャットワークやメモに保存したいとき）</p>
        <p class="small">※ 「この結果をコピー」ボタンを押して、チャットワークやメモに貼り付けてください。</p>
        <button type="button" id="copyBtn">この結果をコピー</button>
        <textarea class="copy-area" id="copyArea" readonly>${copyText}</textarea>
      `;

      resultLinks.innerHTML = html;
      resultDiv.style.display = "block";

      const copyBtn = document.getElementById("copyBtn");
      const copyArea = document.getElementById("copyArea");

      if (copyBtn && copyArea) {
        copyBtn.addEventListener("click", () => {
          const text = copyArea.value;

          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text)
              .then(() => {
                alert("コピーしました。チャットワークやメモに貼り付けてください。");
              })
              .catch(() => {
                copyArea.focus();
                copyArea.select();
                document.execCommand("copy");
                alert("コピーしました。チャットワークやメモに貼り付けてください。");
              });
          } else {
            copyArea.focus();
            copyArea.select();
            document.execCommand("copy");
            alert("コピーしました。チャットワークやメモに貼り付けてください。");
          }
        });
      }
    }
  </script>
</body>
</html>
