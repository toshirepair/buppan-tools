<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>eBay Hot Items Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 860px;
      margin: 0 auto;
      padding: 16px;
      line-height: 1.6;
    }
    h1{ font-size: 1.4rem; margin: 0 0 4px; }
    .sub{ color:#555; font-size:.92rem; margin-bottom: 16px; }

    .card{
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 16px;
    }
    label{ display:block; margin-top: 10px; font-weight: 650; }
    input, select, textarea{
      width: 100%;
      padding: 9px;
      margin-top: 4px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
    }
    textarea{
      min-height: 90px;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.95rem;
    }

    .row{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: stretch;
      margin-top: 12px;
    }
    .row > *{ flex: 1 1 220px; }

    button{
      padding: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    .btn-primary{ background:#0073e6; color:#fff; width:100%; }
    .btn-secondary{ background:#eee; width:100%; }
    .btn-copy{ background:#444; color:#fff; width:100%; }

    .small{ font-size: .9rem; color:#555; margin-top: 8px; }
    .result{ font-size: 1.02rem; margin-top: 10px; }
    .hot{ color:#d32f2f; font-weight: 800; }
    .warm{ color:#f57c00; font-weight: 800; }
    .cold{ color:#1976d2; font-weight: 800; }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.92rem;
      word-break: break-all;
      background: #fafafa;
      border: 1px dashed #ddd;
      padding: 10px;
      border-radius: 8px;
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <h1>ğŸ”¥ eBay Hot Items Checker</h1>
  <div class="sub">ä»Šã®éœ€è¦ Ã— ä¾›çµ¦ã§ã€Œç‹™ã„ç›®ã€ã‹ã‚’è¦‹æ¥µã‚ã‚‹ãƒ„ãƒ¼ãƒ«</div>

  <div class="card">
    <label>â‘  å‹ç•ª / ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
    <input id="keyword" type="text" placeholder="ä¾‹ï¼šD750 / Nikon D750" />

    <label>â‘¡ å£²ã‚Œç­‹ã ã¨æ€ã†ä¾¡æ ¼ï¼ˆä¸­å¿ƒå€¤ï¼‰</label>
    <input id="price" type="number" inputmode="decimal" placeholder="ä¾‹ï¼š750" />

    <label>â‘¢ ä¾¡æ ¼ãƒ¬ãƒ³ã‚¸ï¼ˆÂ±%ï¼‰</label>
    <select id="range">
      <option value="5">Â±5%</option>
      <option value="10" selected>Â±10%</option>
      <option value="15">Â±15%</option>
      <option value="20">Â±20%</option>
      <option value="25">Â±25%</option>
    </select>

    <label>â‘£ ãƒªã‚µãƒ¼ãƒæœŸé–“</label>
    <select id="dayRange">
      <option value="30">30æ—¥</option>
      <option value="90" selected>90æ—¥</option>
      <option value="180">180æ—¥</option>
    </select>

    <div class="row">
      <button class="btn-primary" onclick="openProductResearch()">eBay Product Research ã‚’é–‹ã</button>
    </div>

    <div class="small">
      â€» å£²ã‚ŒãŸæ•°ï¼ˆSoldï¼‰ã¨å‡ºå“æ•°ï¼ˆActiveï¼‰ã¯ã€Product Researchç”»é¢ã‚’è¦‹ã¦ä¸‹ã§å…¥åŠ›ï¼ˆã¾ãŸã¯ã‚³ãƒ”ãƒšï¼‰ã—ã¦ãã ã•ã„ã€‚
    </div>

    <div id="builtUrlWrap" style="display:none;">
      <div class="small" style="margin-top:10px;">ç”ŸæˆURLï¼ˆå‚è€ƒï¼‰</div>
      <div id="builtUrl" class="mono"></div>
    </div>
  </div>

  <div class="card">
    <label>â‘¤ æŒ‡å®šæœŸé–“ã§å£²ã‚ŒãŸæ•°ï¼ˆSoldï¼‰</label>
    <input id="sold" type="number" inputmode="numeric" placeholder="ä¾‹ï¼š30" />

    <label>â‘¥ ç¾åœ¨ã®å‡ºå“æ•°ï¼ˆActive listingsï¼‰</label>
    <input id="active" type="number" inputmode="numeric" placeholder="ä¾‹ï¼š10" />

    <div class="row">
      <button class="btn-secondary" onclick="calculate()">åˆ¤å®šã™ã‚‹</button>
      <button id="copyBtn" class="btn-copy" onclick="copyResult()" style="display:none;">åˆ¤å®šçµæœã‚’ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div id="output"></div>

    <div id="copyAreaWrap" style="display:none; margin-top:12px;">
      <div class="small">ã‚³ãƒ”ãƒ¼å†…å®¹ï¼ˆç¢ºèªç”¨ï¼‰</div>
      <textarea id="copyArea" readonly></textarea>
    </div>
  </div>

<script>
  function n(v){ return Number(v); }

  function floor2(v){ return Math.floor(v); }
  function ceil2(v){ return Math.ceil(v); }

  function fmtDateJP(d){
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }

  function buildProductResearchUrl({keyword, minPrice, maxPrice, dayRange}) {
    // endDate/startDate ã¯ãƒŸãƒªç§’ã‚¨ãƒãƒƒã‚¯ï¼ˆä¾‹URLã«åˆã‚ã›ã‚‹ï¼‰
    const end = Date.now();
    const start = end - (dayRange * 24 * 60 * 60 * 1000);

    const params = new URLSearchParams({
      marketplace: "EBAY-US",
      keywords: keyword,
      dayRange: String(dayRange),
      endDate: String(end),
      startDate: String(start),
      categoryId: "0",
      minPrice: String(minPrice),
      maxPrice: String(maxPrice),
      offset: "0",
      limit: "50",
      sorting: "-avgsalesprice",
      tabName: "SOLD",
      tz: "Asia/Tokyo"
    });

    return `https://www.ebay.com/sh/research?${params.toString()}`;
  }

  function openProductResearch() {
    const keyword = document.getElementById("keyword").value.trim();
    const price = n(document.getElementById("price").value);
    const range = n(document.getElementById("range").value);
    const dayRange = n(document.getElementById("dayRange").value);

    if (!keyword || !price || price <= 0) {
      alert("â‘ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ ã¨ â‘¡ä¾¡æ ¼ï¼ˆä¸­å¿ƒå€¤ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }

    const minPrice = floor2(price * (1 - range/100));
    const maxPrice = ceil2(price * (1 + range/100));

    const url = buildProductResearchUrl({ keyword, minPrice, maxPrice, dayRange });

    // ç”ŸæˆURLè¡¨ç¤º
    document.getElementById("builtUrlWrap").style.display = "block";
    document.getElementById("builtUrl").textContent = url;

    window.open(url, "_blank");
  }

  function calculate() {
    const keyword = document.getElementById("keyword").value.trim();
    const price = n(document.getElementById("price").value);
    const range = n(document.getElementById("range").value);
    const dayRange = n(document.getElementById("dayRange").value);

    const sold = n(document.getElementById("sold").value);
    const active = n(document.getElementById("active").value);

    if (!keyword || !price || price <= 0) {
      alert("â‘ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ ã¨ â‘¡ä¾¡æ ¼ï¼ˆä¸­å¿ƒå€¤ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }
    if (!sold || sold < 0 || Number.isNaN(sold)) {
      alert("â‘¤å£²ã‚ŒãŸæ•°ï¼ˆSoldï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }
    if (Number.isNaN(active) || active < 0) {
      alert("â‘¥å‡ºå“æ•°ï¼ˆActive listingsï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }

    const minPrice = floor2(price * (1 - range/100));
    const maxPrice = ceil2(price * (1 + range/100));

    // æœˆæ›ç®—ï¼šdayRangeæ—¥ã‚’30æ—¥=1ãƒ¶æœˆæ›ç®—
    const monthlySales = (dayRange > 0) ? (sold / (dayRange / 30)) : 0;

    // å¸åæœˆæ•°ï¼ˆä½•ãƒ¶æœˆã§å‡ºå“æ•°ã‚’æ¶ˆåŒ–ã™ã‚‹å¸‚å ´ã‹ï¼‰
    const absorptionMonths = (monthlySales > 0) ? (active / monthlySales) : Infinity;

    let judge = "";
    let cls = "";

    if (absorptionMonths <= 1.5) {
      judge = "ğŸ”¥ HOTï¼šå›è»¢ãŒéå¸¸ã«è‰¯ã„ï¼ˆç‹™ã„ç›®ï¼‰";
      cls = "hot";
    } else if (absorptionMonths <= 4) {
      judge = "ğŸŒ¤ WARMï¼šæ¡ä»¶æ¬¡ç¬¬ã§OKï¼ˆä¾¡æ ¼ãƒ»çŠ¶æ…‹å‹è² ï¼‰";
      cls = "warm";
    } else {
      judge = "â„ COLDï¼šå¯ã‚‹å¯èƒ½æ€§ãŒé«˜ã„";
      cls = "cold";
    }

    const prUrl = buildProductResearchUrl({ keyword, minPrice, maxPrice, dayRange });

    // ç”»é¢è¡¨ç¤º
    const today = new Date();
    const dateStr = fmtDateJP(today);

    const absorptionText = (absorptionMonths === Infinity)
      ? "âˆ"
      : absorptionMonths.toFixed(1);

    document.getElementById("output").innerHTML = `
      <div class="result">
        æŒ‡å®šæœŸé–“ã®Soldï¼š<b>${sold}</b>ï¼ˆ${dayRange}æ—¥ï¼‰<br>
        æœˆæ›ç®—Soldï¼š<b>${monthlySales.toFixed(2)}</b> å€‹ / æœˆ<br>
        å‡ºå“å¸åç›®å®‰ï¼š<b>${absorptionText}</b> ã‹æœˆ
      </div>
      <div class="result ${cls}">
        åˆ¤å®šï¼š${judge}
      </div>
      <div class="small" style="margin-top:10px;">Product Research URL</div>
      <div class="mono">${prUrl}</div>
    `;

    // ã‚³ãƒ”ãƒ¼ç”¨ãƒ†ã‚­ã‚¹ãƒˆï¼ˆâ‘ ã€œâ‘¥ï¼‹URLï¼‹æ—¥ä»˜ï¼‰
    const copyText =
`ã€eBay Hot Items Checker åˆ¤å®šã€‘ï¼ˆ${dateStr}ï¼‰
â‘  ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼š${keyword}
â‘¡ ä¾¡æ ¼ï¼ˆä¸­å¿ƒå€¤ï¼‰ï¼š$${price}
â‘¢ ä¾¡æ ¼ãƒ¬ãƒ³ã‚¸ï¼šÂ±${range}%ï¼ˆ$${minPrice} - $${maxPrice}ï¼‰
â‘£ æœŸé–“ï¼š${dayRange}æ—¥
â‘¤ Soldï¼š${sold}
ã€€æœˆæ›ç®— Soldï¼š${monthlySales.toFixed(2)} / æœˆ
â‘¥ Active listingsï¼š${active}

åˆ¤å®šï¼š${judge}
å‡ºå“å¸åç›®å®‰ï¼š${absorptionText} ã‹æœˆ

Product Research URLï¼š
${prUrl}
`;

    document.getElementById("copyAreaWrap").style.display = "block";
    document.getElementById("copyArea").value = copyText;

    document.getElementById("copyBtn").style.display = "block";
  }

  async function copyResult() {
    const text = document.getElementById("copyArea").value || "";
    if (!text) return;

    try {
      await navigator.clipboard.writeText(text);
      alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    } catch (e) {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šé¸æŠã—ã¦ã‚³ãƒ”ãƒ¼
      const ta = document.getElementById("copyArea");
      ta.focus();
      ta.select();
      document.execCommand("copy");
      alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ï¼ˆäº’æ›ãƒ¢ãƒ¼ãƒ‰ï¼‰");
    }
  }
</script>
</body>
</html>
