<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>仕入れ判断 為替×手数料×利益電卓</title>
<style>
body{font-family:system-ui;background:#fff;margin:0;padding:16px}
.wrap{max-width:900px;margin:auto}
.box{border:1px solid #ddd;border-radius:12px;padding:12px;margin-top:10px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc}
.k{font-size:.85rem;color:#666}
.v{font-size:1.3rem}
button{padding:8px 12px;border-radius:8px;border:1px solid #ccc;background:#f5f5f5}
.chip.active{background:#111;color:#fff}
</style>
</head>
<body>
<div class="wrap">

<h2>仕入れ判断 為替×手数料×利益電卓</h2>

<div class="row">
<button class="chip active" data-cur="JPY">JPY</button>
<button class="chip" data-cur="USD">USD</button>
<button class="chip" data-cur="EUR">EUR</button>
<button id="refresh">レート更新</button>
</div>

<div class="box">
<div class="k">① 売価</div>
<input id="amount" class="input" placeholder="例：120000">
<div id="rate">レート：取得中…</div>
</div>

<div class="box">
<div class="k">② 販売先</div>
<select id="market" class="input">
<option value="ebay">eBay</option>
<option value="catawiki">Catawiki</option>
<option value="domestic">ヤフオク・メルカリ</option>
</select>
</div>

<div class="box">
<div class="k">③ 希望利益（JPY）</div>
<input id="profit" class="input" value="10000">
<div class="k">送料（JPY）</div>
<input id="ship" class="input" value="0">
<div class="k">関税（JPY）</div>
<input id="duty" class="input" value="0">
</div>

<div class="box">
<div class="k">仕入れ判断（JPY）</div>
<div class="v" id="result">—</div>
</div>

</div>

<script>
let active="JPY";
let rates=null;

const chips=document.querySelectorAll(".chip");
chips.forEach(b=>{
b.onclick=()=>{
chips.forEach(x=>x.classList.remove("active"));
b.classList.add("active");
active=b.dataset.cur;
calc();
};
});

async function fetchRate(){
try{
const r=await fetch("https://api.exchangerate.host/latest?base=EUR&symbols=JPY,USD");
const d=await r.json();
rates={JPY:d.rates.JPY,USD:d.rates.USD};
document.getElementById("rate").textContent=
`EUR→JPY ${rates.JPY.toFixed(2)} / EUR→USD ${rates.USD.toFixed(4)}`;
calc();
}catch{
document.getElementById("rate").textContent="レート取得失敗";
}
}

function calc(){
if(!rates) return;
const amt=Number(document.getElementById("amount").value||0);
const profit=Number(document.getElementById("profit").value||0);
const ship=Number(document.getElementById("ship").value||0);
const duty=Number(document.getElementById("duty").value||0);
const market=document.getElementById("market").value;

let jpy=active==="JPY"?amt:
active==="USD"?amt*(rates.JPY/rates.USD):
amt*rates.JPY;

let fee=0;
if(market==="ebay") fee=jpy*(0.15+0.02);
if(market==="catawiki") fee=jpy*0.125;
if(market==="domestic") fee=jpy*0.10;

const buy=jpy-fee-profit-ship-duty;
document.getElementById("result").textContent=
`入札上限：¥${Math.round(buy).toLocaleString()}`;
}

["amount","profit","ship","duty","market"].forEach(id=>{
document.getElementById(id).addEventListener("input",calc);
});

document.getElementById("refresh").onclick=fetchRate;

fetchRate();
</script>
</body>
</html>
