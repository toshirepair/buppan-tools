<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bid Limit Calculator</title>
<style>
body{
  font-family: system-ui,-apple-system,"Segoe UI",sans-serif;
  background:#fff;
  margin:0;
  padding:16px;
}
.wrap{
  max-width:720px;
  margin:auto;
}
h1{
  font-size:1.3rem;
  margin-bottom:12px;
}
.card{
  border:1px solid #ddd;
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
}
.row{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
button.chip{
  border:1px solid #ccc;
  border-radius:999px;
  padding:8px 14px;
  background:#f3f3f3;
  cursor:pointer;
}
button.chip.active{
  background:#111;
  color:#fff;
  border-color:#111;
}
.input,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:4px;
}
.k{
  font-size:.85rem;
  color:#666;
}
.v{
  font-size:1.4rem;
  font-weight:600;
}
.small{
  font-size:.8rem;
  color:#777;
  margin-top:6px;
}
.copy{
  cursor:pointer;
}
.copy:active{
  opacity:.6;
}
</style>
</head>
<body>
<div class="wrap">

<h1>Bid Limit Calculator</h1>

<!-- 通貨 -->
<div class="card">
  <div class="k">① 売価通貨</div>
  <div class="row">
    <button class="chip active" data-cur="JPY">JPY</button>
    <button class="chip" data-cur="USD">USD</button>
    <button class="chip" data-cur="EUR">EUR</button>
  </div>

  <div class="k" style="margin-top:10px;">売価</div>
  <input id="amount" class="input" placeholder="例：120000">
</div>

<!-- 為替（手動） -->
<div class="card">
  <div class="k">② 為替レート（手動入力）</div>

  <div class="k">1 USD = JPY</div>
  <input id="usdJpy" class="input" placeholder="例：150">

  <div class="k" style="margin-top:6px;">1 EUR = JPY</div>
  <input id="eurJpy" class="input" placeholder="例：163">

  <div class="small">
    ※ 入力したレートは、このブラウザに自動保存されます
  </div>
</div>

<!-- 販売先 -->
<div class="card">
  <div class="k">③ 販売先</div>
  <select id="market" class="input">
    <option value="ebay">eBay</option>
    <option value="catawiki">Catawiki</option>
    <option value="domestic">ヤフオク・メルカリ</option>
  </select>

  <div class="small" id="feeNote"></div>
</div>

<!-- 利益・コスト -->
<div class="card">
  <div class="k">④ 利益・コスト</div>

  <div class="k">利益（JPY）</div>
  <input id="profit" class="input" value="10000">

  <div class="k" style="margin-top:6px;">送料（JPY）</div>
  <input id="ship" class="input" value="0">

  <div class="k" style="margin-top:6px;">関税（JPY）</div>
  <input id="duty" class="input" value="0">
</div>

<!-- 結果 -->
<div class="card">
  <div class="k">入札予約金額（タップでコピー）</div>
  <div class="v copy" id="bidLimit">—</div>
  <div class="small" id="copyMsg"></div>
</div>

</div>

<script>
let active="JPY";
const chips=document.querySelectorAll(".chip");
const usdJpy=document.getElementById("usdJpy");
const eurJpy=document.getElementById("eurJpy");

// restore rate
usdJpy.value=localStorage.getItem("usdJpy")||"";
eurJpy.value=localStorage.getItem("eurJpy")||"";

chips.forEach(b=>{
  b.onclick=()=>{
    chips.forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    active=b.dataset.cur;
    calc();
  };
});

function calc(){
  const amount=Number(document.getElementById("amount").value||0);
  const usd=Number(usdJpy.value||0);
  const eur=Number(eurJpy.value||0);
  const profit=Number(document.getElementById("profit").value||0);
  const ship=Number(document.getElementById("ship").value||0);
  const duty=Number(document.getElementById("duty").value||0);
  const market=document.getElementById("market").value;

  if(usd<=0||eur<=0||amount<=0) return;

  localStorage.setItem("usdJpy",usd);
  localStorage.setItem("eurJpy",eur);

  let jpy=
    active==="JPY"?amount:
    active==="USD"?amount*usd:
    amount*eur;

  let feeRate=0;
  let note="";

  if(market==="ebay"){
    feeRate=0.15+0.02;
    note="eBay：15% + Payoneer：2%";
  }
  if(market==="catawiki"){
    feeRate=0.125+0.02;
    note="Catawiki：12.5% + Payoneer：2%";
  }
  if(market==="domestic"){
    feeRate=0.10;
    note="ヤフオク・メルカリ：10%";
  }

  document.getElementById("feeNote").textContent=note;

  const bid=jpy-(jpy*feeRate)-profit-ship-duty;
  document.getElementById("bidLimit").textContent=
    "¥"+Math.round(bid).toLocaleString();
}

["amount","usdJpy","eurJpy","profit","ship","duty","market"]
.forEach(id=>{
  document.getElementById(id).addEventListener("input",calc);
});

document.getElementById("bidLimit").onclick=()=>{
  const v=document.getElementById("bidLimit").textContent;
  if(v==="—") return;
  navigator.clipboard.writeText(v.replace(/[¥,]/g,""));
  document.getElementById("copyMsg").textContent="コピーしました";
  setTimeout(()=>document.getElementById("copyMsg").textContent="",1200);
};
</script>
</body>
</html>
