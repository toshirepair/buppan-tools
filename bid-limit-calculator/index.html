<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bid Limit Calculator</title>
<style>
*{box-sizing:border-box}
body{
  font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
  background:#fff;
  margin:0;
  padding:16px;
}
.wrap{max-width:760px;margin:auto}
h1{font-size:1.35rem;margin:0 0 12px}

.card{
  border:1px solid #ddd;
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
}

.k{font-size:.85rem;color:#666}
.small{font-size:.8rem;color:#777;line-height:1.4}
.row{display:flex;gap:8px;flex-wrap:wrap}

.input,select{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:4px;
  font-size:1rem;
}

.rateInput{
  background:#f1f1f1;
}
.rateInput.filled{
  background:#fff;
}

.moneyWrap{
  display:flex;
  border:1px solid #ccc;
  border-radius:10px;
  overflow:hidden;
  margin-top:4px;
}
.prefix{
  padding:10px 12px;
  background:#fafafa;
  border-right:1px solid #e5e5e5;
  font-weight:600;
}
.moneyInput{
  border:0;
  outline:none;
  padding:10px 12px;
  width:100%;
  font-size:1rem;
}

.chip{
  border:1px solid #ccc;
  border-radius:999px;
  padding:8px 14px;
  background:#f3f3f3;
  cursor:pointer;
}
.chip.active{
  background:#111;color:#fff;border-color:#111;
}

.v{font-size:1.5rem;font-weight:700}
.copyTap{cursor:pointer}
.copyTap:active{opacity:.6}

.line{
  display:flex;
  justify-content:space-between;
  padding:4px 0;
  font-size:.95rem;
}
.line .r{font-weight:600}

.btn{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  background:#f6f6f6;
  margin-top:10px;
  cursor:pointer;
}
</style>
</head>
<body>
<div class="wrap">
<h1>Bid Limit Calculator</h1>

<!-- 為替 -->
<div class="card">
  <div class="k">① 為替レート（手動入力）</div>

  <div class="k">1 USD = JPY</div>
  <input id="usdJpy" class="input rateInput" placeholder="例：156">

  <div class="k" style="margin-top:6px">1 EUR = JPY</div>
  <input id="eurJpy" class="input rateInput" placeholder="例：183">

  <div class="small">※ 入力すると自動保存されます</div>
</div>

<!-- 販売先 -->
<div class="card">
  <div class="k">② 販売先</div>
  <select id="market" class="input">
    <option value="ebay">eBay</option>
    <option value="catawiki">Catawiki</option>
    <option value="domestic">ヤフオク・メルカリ</option>
  </select>
  <div class="small" id="feeNote"></div>
</div>

<!-- 売価 -->
<div class="card">
  <div class="k">③ 売価通貨・売価</div>
  <div class="row">
    <button class="chip active" data-cur="JPY">JPY</button>
    <button class="chip" data-cur="USD">USD</button>
    <button class="chip" data-cur="EUR">EUR</button>
  </div>

  <div class="moneyWrap">
    <div class="prefix" id="prefix">¥</div>
    <input id="amount" class="moneyInput" placeholder="例：20000">
  </div>
</div>

<!-- 利益・コスト -->
<div class="card">
  <div class="k">④ 利益・コスト</div>

  <div class="k">利益（JPY）</div>
  <input id="profit" class="input" value="10000">

  <div class="k" style="margin-top:6px">
    <label>
      <input type="checkbox" id="taxCheck">
      消費税10％ ※ストア出品者から買う時に入力する
    </label>
  </div>

  <div class="k" style="margin-top:6px">送料（JPY）※送料込みで売る時に入力する</div>
  <input id="ship" class="input" value="0">

  <div class="k" style="margin-top:6px">関税（JPY）※DDPセラー払いの時に入力する</div>
  <input id="duty" class="input" value="0">
</div>

<!-- 結果 -->
<div class="card">
  <div class="k">仕入（入札上限）※タップでコピー</div>
  <div class="v copyTap" id="bid">—</div>

  <div class="small" id="breakTitle" style="margin-top:8px">内訳（円換算）</div>

  <div class="line"><div>販売先</div><div class="r" id="bMarket">—</div></div>
  <div class="line"><div>売価</div><div class="r" id="bGross">—</div></div>
  <div class="line"><div>手数料</div><div class="r" id="bFee">—</div></div>
  <div class="line"><div>入金額</div><div class="r" id="bPayout">—</div></div>
  <div class="line"><div>送料</div><div class="r" id="bShip">—</div></div>
  <div class="line"><div>関税</div><div class="r" id="bDuty">—</div></div>
  <div class="line"><div>仕入（入札上限）</div><div class="r" id="bBid">—</div></div>
  <div class="line"><div>利益</div><div class="r" id="bProfit">—</div></div>

  <button class="btn" id="copyAll">結果をコピー</button>
  <div class="small" id="copyMsg"></div>
</div>
</div>

<script>
const $=id=>document.getElementById(id);
const chips=document.querySelectorAll(".chip");
let cur="JPY";

function feeRate(m){
  if(m==="ebay")return .17;
  if(m==="catawiki")return .145;
  return .10;
}

function feeNote(m){
  if(m==="ebay")return"eBay：15% + Payoneer：2%";
  if(m==="catawiki")return"Catawiki：12.5% + Payoneer：2%";
  return"ヤフオク・メルカリ：10%";
}

function calc(){
  const a=+$("amount").value||0;
  const u=+$("usdJpy").value||0;
  const e=+$("eurJpy").value||0;
  const p=+$("profit").value||0;
  const s=+$("ship").value||0;
  const d=+$("duty").value||0;
  const tax=$("taxCheck").checked;
  const m=$("market").value;

  $("feeNote").textContent=feeNote(m);
  $("bMarket").textContent=m==="domestic"?"ヤフオク・メルカリ":m;

  if(!a)return;

  let gross=a;
  let rateText="";
  if(cur==="USD"){gross=a*u;rateText=`（1 USD = ${u} JPY）`}
  if(cur==="EUR"){gross=a*e;rateText=`（1 EUR = ${e} JPY）`}

  const fee=gross*feeRate(m);
  let payout=gross-fee;
  let bid=payout-s-d-p;
  if(tax) bid=bid/1.1;

  $("bid").textContent=`¥${Math.round(bid).toLocaleString()}`;
  $("bBid").textContent=$("bid").textContent;
  $("bProfit").textContent=`¥${p.toLocaleString()}`;
  $("bShip").textContent=`¥${s.toLocaleString()}`;
  $("bDuty").textContent=`¥${d.toLocaleString()}`;
  $("bFee").textContent=`¥${Math.round(fee).toLocaleString()}`;
  $("bPayout").textContent=`¥${Math.round(payout).toLocaleString()}`;
  $("bGross").textContent=
    `${cur==="JPY"?"¥":cur==="USD"?"$":"€"}${a} → ¥${Math.round(gross).toLocaleString()} ${rateText}`;
}

chips.forEach(c=>{
  c.onclick=()=>{
    chips.forEach(x=>x.classList.remove("active"));
    c.classList.add("active");
    cur=c.dataset.cur;
    $("prefix").textContent=cur==="JPY"?"¥":cur==="USD"?"$":"€";
    calc();
  };
});

["amount","usdJpy","eurJpy","profit","ship","duty","market","taxCheck"]
.forEach(id=>$(id).addEventListener("input",calc));

["usdJpy","eurJpy"].forEach(id=>{
  $(id).addEventListener("input",e=>{
    e.target.classList.toggle("filled",e.target.value!=="");
  });
});

$("bid").onclick=()=>{
  navigator.clipboard.writeText($("bid").textContent.replace(/[¥,]/g,""));
};

$("copyAll").onclick=()=>{
  navigator.clipboard.writeText(document.querySelector(".card:last-child").innerText);
  $("copyMsg").textContent="コピーしました";
};
</script>
</body>
</html>
